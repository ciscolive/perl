.\" Automatically generated by Pod::Man 4.14 (Pod::Simple 3.40)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is >0, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{\
.    if \nF \{\
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{\
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "Net::Appliance::Session 3"
.TH Net::Appliance::Session 3 "2020-07-11" "perl v5.32.0" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
Net::Appliance::Session \- Run command\-line sessions to network appliances
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
.Vb 1
\& use Net::Appliance::Session;
\& 
\& my $s = Net::Appliance::Session\->new({
\&     personality => \*(Aqios\*(Aq,
\&     transport => \*(AqSSH\*(Aq,
\&     host => \*(Aqhostname.example\*(Aq,
\&     privileged_paging => 1, # only if using ASA/PIX OS 7+
\&                             # and there are other behaviour options, see below
\& });
\& 
\& try {
\&     $s\->connect({ username => \*(Aqusername\*(Aq, password => \*(Aqloginpass\*(Aq });
\& 
\&     $s\->begin_privileged({ password => \*(Aqprivilegedpass\*(Aq });
\&     print $s\->cmd(\*(Aqshow access\-list\*(Aq);
\&     $s\->end_privileged;
\& }
\& catch {
\&     warn "failed to execute command: $_";
\& }
\& finally {
\&     $s\->close;
\& };
.Ve
.PP
or, try the bundled \f(CW\*(C`nas\*(C'\fR helper script (beta feature!):
.PP
.Vb 1
\& nas \-\-help
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
Use this module to establish an interactive command-line session with a
network appliance. There is special support for moving into \*(L"privileged\*(R" mode
and \*(L"configure\*(R" mode, along with the ability to send commands to the connected
device and retrieve returned output.
.PP
There are other \s-1CPAN\s0 modules that cover similar ground, but they are less
robust and do not handle native \s-1SSH,\s0 Telnet and Serial Line connections with a
single interface on both Unix and Windows platforms.
.PP
Built-in commands come from a phrasebook which supports many network device
vendors (Cisco, \s-1HP,\s0 etc) or you can install a new phrasebook. Most phases of
the connection are configurable for different device behaviours.
.SH "METHODS"
.IX Header "METHODS"
As in the synopsis above, the first step is to create a new instance.
.PP
Recommended practice is to wrap all other calls (except \f(CW\*(C`close()\*(C'\fR) in a
\&\f(CW\*(C`try\*(C'\fR block, to catch errors (typically time-outs waiting for \s-1CLI\s0 response).
This module exports the \f(CW\*(C`try/catch/finally\*(C'\fR methods (from Try::Tiny) into
your namespace as a simpler alternative to using \f(CW\*(C`eval()\*(C'\fR.
.PP
For a full demonstration of usage, see the example script shipped with this
distribution.
.SS "Net::Appliance::Session\->new( \e%options )"
.IX Subsection "Net::Appliance::Session->new( %options )"
.Vb 5
\& my $s = Net::Appliance::Session\->new({
\&     personality => \*(Aqios\*(Aq,
\&     transport => \*(AqSSH\*(Aq,
\&     host => \*(Aqhostname.example\*(Aq,
\& });
.Ve
.PP
Prepares a new session for you, but will not connect to any device. Some
options are required, others optional:
.ie n .IP """personality => $name"" (required)" 4
.el .IP "\f(CWpersonality => $name\fR (required)" 4
.IX Item "personality => $name (required)"
Tells the module which \*(L"language\*(R" to use when talking to the connected device,
for example \f(CW\*(C`ios\*(C'\fR for Cisco \s-1IOS\s0 devices. There's a list of all the supported
platforms in the Phrasebook
documentation. It's also possible to write new phrasebooks.
.ie n .IP """transport => $backend"" (required)" 4
.el .IP "\f(CWtransport => $backend\fR (required)" 4
.IX Item "transport => $backend (required)"
The name of the transport backend used for the session, which may be one of
Telnet,
\&\s-1SSH\s0, or
Serial.
.ie n .IP """app => $location"" (required on Windows)" 4
.el .IP "\f(CWapp => $location\fR (required on Windows)" 4
.IX Item "app => $location (required on Windows)"
On Windows platforms, you \fBmust\fR download the \f(CW\*(C`plink.exe\*(C'\fR program, and pass
its location in this parameter.
.ie n .IP """host => $hostname"" (required for Telnet and \s-1SSH\s0 transports)" 4
.el .IP "\f(CWhost => $hostname\fR (required for Telnet and \s-1SSH\s0 transports)" 4
.IX Item "host => $hostname (required for Telnet and SSH transports)"
When using the Telnet and \s-1SSH\s0 transports, you \fBmust\fR provide the \s-1IP\s0 or host
name of the target device in this parameter.
.ie n .IP """timeout => $seconds""" 4
.el .IP "\f(CWtimeout => $seconds\fR" 4
.IX Item "timeout => $seconds"
Configures a global default timeout value, in seconds, for interaction with
the remote device. The default is 10 seconds. You can also set timeout on a
per-command or per-macro call (see below).
.ie n .IP """connect_options => \e%options""" 4
.el .IP "\f(CWconnect_options => \e%options\fR" 4
.IX Item "connect_options => %options"
Some of the transport backends can take their own options. For example with a
serial line connection you might specify the port speed, etc. See the
respective manual pages for each transport backend for further details
(\s-1SSH\s0,
Telnet,
Serial).
.ie n .IP """add_library => $directory | \e@directories""" 4
.el .IP "\f(CWadd_library => $directory | \e@directories\fR" 4
.IX Item "add_library => $directory | @directories"
If you've added to the built-in phrasebook with your own macros, then use
this option to load your new phrasebook file(s). The path here should be the
directory within which all your personalities are located, such as:
.Sp
.Vb 2
\& ${directory}/cisco/ios/pb
\& ${directory}/other/device/pb
.Ve
.Sp
Usually the phrasebook files are called "\f(CW\*(C`pb\*(C'\fR" and to the \f(CW\*(C`personality\*(C'\fR
option you pass the containing directory name, for example \f(CW\*(C`ios\*(C'\fR or \f(CW\*(C`device\*(C'\fR
in the examples shown. See Net::CLI::Interact::Manual::Tutorial for
further details.
.ie n .IP """nci_options => \e%options""" 4
.el .IP "\f(CWnci_options => \e%options\fR" 4
.IX Item "nci_options => %options"
Should you wish to reconfigure the Net::CLI::Interact instance used inside
of \f(CW\*(C`Net::Appliance::Session\*(C'\fR, perhaps for an option not supported above, this
generic setting is available.
.SS "connect( \e%options )"
.IX Subsection "connect( %options )"
.Vb 1
\& $s\->connect({ username => $myname, password => $mysecret });
.Ve
.PP
To establish a connection to the device, and possibly also log in, call this
method. Following a successful connection, paging of device output will be
disabled using commands appropriate to the platform. This feature can be
suppressed (see \*(L"\s-1CONFIGURATION\*(R"\s0, below).
.PP
Options available to this method, sometimes required, are:
.ie n .IP """username => $name""" 4
.el .IP "\f(CWusername => $name\fR" 4
.IX Item "username => $name"
The login username for the device. Whether this is required depends both on
how the device is configured, and how you have configured this module to act.
If it looks like the device presented a Username prompt. and you don't pass
the username a Perl exception will be thrown.
.Sp
The username is cached within the module for possible use later on when
entering \*(L"privileged\*(R" mode.
.ie n .IP """password => $secret""" 4
.el .IP "\f(CWpassword => $secret\fR" 4
.IX Item "password => $secret"
The login password for the device. Whether this is required depends both on
how the device is configured, and how you have configured this module to act.
If it looks like the device presented a Username prompt. and you don't pass
the username a Perl exception will be thrown.
.Sp
The password is cached within the module for possible use later on when
entering \*(L"privileged\*(R" mode.
.ie n .IP """privileged_password => $secret"" (optional)" 4
.el .IP "\f(CWprivileged_password => $secret\fR (optional)" 4
.IX Item "privileged_password => $secret (optional)"
In the situation where you've activated \*(L"privileged paging\*(R", yet your device
uses a different password for privileged mode than login, you'll need to set
that other password here.
.Sp
Otherwise, because the module tries to disable paging, it first goes into
privileged mode as you instructed, and fails with the wrong (login) password.
.SS "begin_privileged and end_privileged"
.IX Subsection "begin_privileged and end_privileged"
.Vb 3
\& $s\->begin_privileged;
\& # do some work
\& $s\->end_privileged;
.Ve
.PP
Once you have connected to the device, change to \*(L"privileged\*(R" mode by calling
the \f(CW\*(C`begin_privileged\*(C'\fR method. The appropriate command will be issued for
your device platform, from the phrasebook. Likewise to exit \*(L"privileged\*(R" mode
call the \f(CW\*(C`end_privileged\*(C'\fR method.
.PP
Sometimes authentication is required to enter \*(L"privileged\*(R" mode. In that case,
the module defaults to using the username and password first passed in the
\&\f(CW\*(C`connect\*(C'\fR method. However to either override those or set them in case they
were not passed to \f(CW\*(C`connect\*(C'\fR, use either or both of the following options to
\&\f(CW\*(C`begin_privileged\*(C'\fR:
.PP
.Vb 1
\& $s\->begin_privileged({ username => $myname, password => $mysecret });
.Ve
.SS "begin_configure and end_configure"
.IX Subsection "begin_configure and end_configure"
.Vb 3
\& $s\->begin_configure;
\& # make some changes
\& $s\->end_configure;
.Ve
.PP
To enter \*(L"configuration\*(R" mode for your device platform, call the
\&\f(CW\*(C`begin_configure\*(C'\fR method. This checks you are already in \*(L"privileged\*(R" mode,
as the module assumes this is necessary. If it isn't necessary then see
\&\*(L"\s-1CONFIGURATION\*(R"\s0 below to modify this behaviour. Likewise to exit
\&\*(L"configure\*(R" mode, call the \f(CW\*(C`end_configure\*(C'\fR method.
.ie n .SS "cmd( $command )"
.el .SS "cmd( \f(CW$command\fP )"
.IX Subsection "cmd( $command )"
.Vb 2
\& my $config     = $s\->cmd(\*(Aqshow running\-config\*(Aq);
\& my @interfaces = $s\->cmd(\*(Aqshow interfaces brief\*(Aq);
.Ve
.PP
Execute a single command statement on the connected device. The statement is
executed verbatim on the device, with a newline appended.
.PP
In scalar context the response is returned as a single string. In list context
the gathered response is returned as a list of lines. In both cases your local
platform's newline character will end all lines.
.PP
You can also call the \f(CW\*(C`last_response\*(C'\fR method which returns the same data with
the same contextual behaviour.
.PP
This method accepts a hashref of options following the \f(CW$command\fR, which can
include a \f(CW\*(C`timeout\*(C'\fR value to permit long running commands to have all their
output gathered.
.PP
To handle more complicated interactions, for example commands which prompt for
confirmation or optional parameters, you should use a Macro. These are set up
in the phrasebook and issued via the \f(CW\*(C`$s\->macro($name)\*(C'\fR method call. See
the Phrasebook and
Cookbook manual pages for further
details.
.PP
If you receive response text with a \*(L"mangled\*(R" copy of the issued command at
the start, then it's likely you need to set the terminal width. This prevents
the connected device from line-wrapping long commands. Issue something like:
.PP
.Vb 2
\& $s\->begin_privileged;
\& $s\->cmd(\*(Aqterminal width 510\*(Aq);
.Ve
.SS "close"
.IX Subsection "close"
.Vb 1
\& $s\->close;
.Ve
.PP
Once you have finished work with the device, call this method. It attempts to
back out of any \*(L"privileged\*(R" or \*(L"configuration\*(R" mode you've entered, re-enable
paging (unless suppressed) and then disconnect.
.PP
If a macro named \f(CW"disconnect"\fR exists in the loaded phrasebook then it's
called just before disconnection. This allows you to issue a command such as
\&\f(CW"exit"\fR to cleanly log out.
.SH "CONFIGURATION"
.IX Header "CONFIGURATION"
Each of the entries below may either be passed as a parameter in the options
to the \f(CW\*(C`new\*(C'\fR method, or called as a method in its own right and passed the
appropriate setting. If doing the latter, it should be before you call the
\&\f(CW\*(C`connect\*(C'\fR method.
.IP "do_login" 4
.IX Item "do_login"
Defaults to true. Pass a zero (false) to disable logging in to the device with
a username and password, should you get a command prompt immediately upon
connection.
.IP "do_privileged_mode" 4
.IX Item "do_privileged_mode"
Defaults to true. If on connecting to the device your user is immediately in
\&\*(L"privieleged\*(R" mode, then set this to zero (false), which permits immediate
access to \*(L"configure\*(R" mode.
.IP "do_configure_mode" 4
.IX Item "do_configure_mode"
Defaults to true. If you set this to zero (false), the module assumes you're
in \*(L"configure\*(R" mode immediately upon entering \*(L"privileged\*(R" mode. I can't think
why this would be useful but you never know.
.IP "do_paging" 4
.IX Item "do_paging"
Defaults to true. Pass a zero (false) to disable the post-login
reconfiguration of a device which avoids paged command output. If you cleanly
\&\f(CW\*(C`close\*(C'\fR the device connection then paging is re-enabled. Use this option to
suppress these steps.
.IP "privileged_paging" 4
.IX Item "privileged_paging"
Defaults to false. On some series of devices, in particular the Cisco \s-1ASA\s0 and
\&\s-1PIXOS7+\s0 you must be in privileged mode in order to alter the pager. If that is
the case for your device, call this method with a true value to instruct the
module to better manage the situation.
.IP "pager_enable_lines" 4
.IX Item "pager_enable_lines"
Defaults to 24. The command issued to re-enable paging (on disconnect)
typically takes a parameter which is the number of lines per page. If you want
a different value, set it in this option.
.IP "pager_disable_lines" 4
.IX Item "pager_disable_lines"
Defaults to zero. The command issued to disable paging typically takes a
parameter which is the number of lines per page (zero begin to disable
paging). If your device uses a different number here, set it in this option.
.IP "wake_up" 4
.IX Item "wake_up"
When first connecting to the device, the most common scenario is that a
Username (or some other) prompt is shown. However if no output is forthcoming
and nothing matches, the \*(L"enter\*(R" key is pressed, in the hope of triggering the
display of a new prompt. This is typically most useful on Serial connected
devices.
.Sp
Set this configuration option to zero to suppress this behaviour, or to the
number of times \*(L"enter\*(R" should be pressed and output waited for. The default
is to press \*(L"enter\*(R" once.
.SH "ASYNCHRONOUS BEHAVIOUR"
.IX Header "ASYNCHRONOUS BEHAVIOUR"
The standard, and recommended way to use this module is as above, whereby the
application is blocked waiting for command response. It's also possible to
send a command, and separately return to ask for output at a later time.
.PP
.Vb 1
\& $s\->say(\*(Aqshow clock\*(Aq);
.Ve
.PP
This will send the command \f(CW\*(C`show clock\*(C'\fR to the connected device, followed by
a newline character.
.PP
.Vb 1
\& $s\->gather();
.Ve
.PP
This will gather and return output, with similar behaviour to \f(CW\*(C`cmd()\*(C'\fR, above.
That is, it blocks waiting for output and a prompt, will timeout, and accepts
the same options.
.PP
You can still use \f(CW\*(C`last_response\*(C'\fR after calling \f(CW\*(C`gather\*(C'\fR, however be aware
that the command (from \f(CW\*(C`say\*(C'\fR) may be echoed at the start of the output,
depending on device and connection transport.
.SH "DIAGNOSTICS"
.IX Header "DIAGNOSTICS"
To see a log of all the processes within this module, and a copy of all data
sent to and received from the device, call the following method:
.PP
.Vb 1
\& $s\->set_global_log_at(\*(Aqnotice\*(Aq);
.Ve
.PP
In place of \f(CW\*(C`notice\*(C'\fR you can have other log levels (e.g. \f(CW\*(C`debug\*(C'\fR for more,
or \f(CW\*(C`info\*(C'\fR for less), and via the embedded
Logger at \f(CW\*(C`$s\->nci\->logger\*(C'\fR it's possible
to finely control the diagnostics.
.SH "INTERNALS"
.IX Header "INTERNALS"
See Net::CLI::Interact.
.SH "THANKS"
.IX Header "THANKS"
Over several years I have received many patches and suggestions for
improvement from users of this module. My heartfelt thanks to all, for their
contributions.
.SH "AUTHOR"
.IX Header "AUTHOR"
Oliver Gorwits <oliver@cpan.org>
.SH "COPYRIGHT AND LICENSE"
.IX Header "COPYRIGHT AND LICENSE"
This software is copyright (c) 2019 by Oliver Gorwits.
.PP
This is free software; you can redistribute it and/or modify it under
the same terms as the Perl 5 programming language system itself.
