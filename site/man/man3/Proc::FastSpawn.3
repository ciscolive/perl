.\" Automatically generated by Pod::Man 4.14 (Pod::Simple 3.40)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is >0, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{\
.    if \nF \{\
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{\
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\" ========================================================================
.\"
.IX Title "FastSpawn 3"
.TH FastSpawn 3 "2013-06-10" "perl v5.32.0" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
Proc::FastSpawn \- fork+exec, or spawn, a subprocess as quickly as possible
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
.Vb 1
\&   use Proc::FastSpawn;
\&
\&   # simple use
\&   my $pid = spawn "/bin/echo", ["echo", "hello, world"];
\&   ...
\&   waitpid $pid, 0;
\&
\&   # with environment
\&   my $pid = spawn "/bin/echo", ["echo", "hello, world"], ["PATH=/bin", "HOME=/tmp"];
\&
\&   # inheriting file descriptors
\&   pipe R, W or die;
\&   fd_inherit fileno W;
\&   my $pid = spawn "/bin/sh", ["sh", "\-c", "echo a pipe >&" . fileno W];
\&   close W;
\&   print <R>;
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
The purpose of this small (in scope and footprint) module is simple:
spawn a subprocess asynchronously as efficiently and/or fast as
possible. Basically the same as calling fork+exec (on \s-1POSIX\s0), but
hopefully faster than those two syscalls.
.PP
Apart from fork overhead, this module also allows you to fork+exec
programs when otherwise you couldn't \- for example, when you use \s-1POSIX\s0
threads in your perl process then it generally isn't safe to call
fork from perl, but it is safe to use this module to execute external
processes.
.PP
If neither of these are problems for you, you can safely ignore this
module.
.PP
So when is fork+exec not fast enough, how can you do it faster, and why
would it matter?
.PP
Forking a process requires making a complete copy of a process. Even
thought almost every implementation only copies page tables and not the
memory itself, this is still not free. For example, on my 3.6GHz amd64
box, I can fork a 5GB process only twenty times a second. For a real-time
process that must meet stricter deadlines, this is too slow. For a busy
and big web server, starting \s-1CGI\s0 scripts might mean unacceptable overhead.
.PP
A workaround is to use \f(CW\*(C`vfork\*(C'\fR \- this function isn't very portable, but
it avoids the memory copy that \f(CW\*(C`fork\*(C'\fR has to do. Some systems have an
optimised implementation of \f(CW\*(C`spawn\*(C'\fR, and some systems have nothing.
.PP
This module tries to abstract these differences away.
.PP
As for what improvements to expect \- on the 3.6GHz amd64 box that this
module was originally developed on, a 3MB perl process (basically just
perl + Proc::FastSpawn) takes 3.6s to run /bin/true 10000 times using
fork+exec, and only 2.6s when using vfork+exec. In a 22MB process, the
difference is already 5.0s vs 2.6s, and so on.
.SH "FUNCTIONS"
.IX Header "FUNCTIONS"
All the following functions are currently exported by default.
.ie n .IP "$pid = spawn $path, \e@argv[, \e@envp]" 4
.el .IP "\f(CW$pid\fR = spawn \f(CW$path\fR, \e@argv[, \e@envp]" 4
.IX Item "$pid = spawn $path, @argv[, @envp]"
Creates a new process and tries to make it execute \f(CW$path\fR, with the given
arguments and optionally the given environment variables, similar to
calling fork + execv, or execve.
.Sp
Returns the \s-1PID\s0 of the new process if successful. On any error, \f(CW\*(C`undef\*(C'\fR
is currently returned. Failure to execution might or might not be reported
as \f(CW\*(C`undef\*(C'\fR, or via a subprocess exit status of \f(CW127\fR.
.ie n .IP "$pid = spawnp $file, \e@argv[, \e@envp]" 4
.el .IP "\f(CW$pid\fR = spawnp \f(CW$file\fR, \e@argv[, \e@envp]" 4
.IX Item "$pid = spawnp $file, @argv[, @envp]"
Like \f(CW\*(C`spawn\*(C'\fR, but searches \f(CW$file\fR in \f(CW$ENV{PATH}\fR like the shell would
do.
.ie n .IP "fd_inherit $fileno[, $on]" 4
.el .IP "fd_inherit \f(CW$fileno\fR[, \f(CW$on\fR]" 4
.IX Item "fd_inherit $fileno[, $on]"
File descriptors can be inherited by the spawned processes or not. This is
decided on a per file descriptor basis. This module does nothing to any
preexisting handles, but with this call, you can change the state of a
single file descriptor to either be inherited (\f(CW$on\fR is true or missing)
or not \f(CW$on\fR is false).
.Sp
Free portability pro-tip: it seems native win32 perls ignore $^F and set
all file handles to be inherited by default \- but this function can switch
it off.
.SH "PORTABILITY NOTES"
.IX Header "PORTABILITY NOTES"
On \s-1POSIX\s0 systems, this module currently calls vfork+exec, spawn, or
fork+exec, depending on the platform. If your platform has a good vfork or
spawn but is misdetected and falls back to slow fork+exec, drop me a note.
.PP
On win32, the \f(CW\*(C`_spawn\*(C'\fR family of functions is used, and the module tries
hard to patch the new process into perl's internal pid table, so the pid
returned should work with other Perl functions such as waitpid. Also,
win32 doesn't have a meaningful way to quote arguments containing
\&\*(L"special\*(R" characters, so this module tries it's best to quote those
strings itself. Other typical platform limitations (such as being able to
only have 64 or so subprocesses) are not worked around.
.SH "AUTHOR"
.IX Header "AUTHOR"
.Vb 2
\& Marc Lehmann <schmorp@schmorp.de>
\& http://home.schmorp.de/
.Ve
