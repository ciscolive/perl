.\" Automatically generated by Pod::Man 4.14 (Pod::Simple 3.40)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is >0, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{\
.    if \nF \{\
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{\
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\" ========================================================================
.\"
.IX Title "PGTOP 1"
.TH PGTOP 1 "2020-09-25" "perl v5.32.0" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
pgtop \- display PostgreSQL performance info like `top'
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
\&\fBpgtop\fR [options]
.SH "AVAILABILITY"
.IX Header "AVAILABILITY"
The latest version of \fBpgtop\fR is available from
<https://metacpan.org/author/COSIMO> or on github
at <https://github.com/cosimo/pgtop>.
.SH "REQUIREMENTS"
.IX Header "REQUIREMENTS"
In order for \fBpgtop\fR to function properly, you must have the
following:
.PP
.Vb 4
\&  * Perl 5.014 or newer
\&  * Getopt::Long
\&  * DBI and DBD::Pg
\&  * Term::ReadKey
.Ve
.PP
Most systems are likely to have all of those installed or readily available.
.PP
And you obviously need access to a PostgreSQL server (version 7.2+)
with the necessary security to access the \fIpg_stat*\fR relations.
.SS "Optional Color Support"
.IX Subsection "Optional Color Support"
In additon, if you want a color \fBmytop\fR (recommended), install
Term::ANSIColor from the \s-1CPAN:\s0
.PP
.Vb 1
\&    https://metacpan.org/module/Term::ANSIColor
.Ve
.PP
Once you do, \fBpgtop\fR will automatically use it. However, color is not
yet working on Windows. Patches welcome. :\-)
.SS "Optional Hi-Res Timing"
.IX Subsection "Optional Hi-Res Timing"
If you want \fBpgtop\fR to provide more accurate real-time
queries-per-second statistics, install the Time::HiRes module from
\&\s-1CPAN.\s0  \fBpgtop\fR will automatically notice that you have it and use it
rather than the standard timing mechanism.
.SS "Platforms"
.IX Subsection "Platforms"
\&\fBpgtop\fR currently is known to work only on Linux. Its `mytop' brother,
however, has been reported to work on:
.PP
.Vb 6
\&  * Linux (2.2.x, 2.4.x) ?
\&  * FreeBSD (2.2, 3.x, 4.x) ?
\&  * Mac OS X ?
\&  * BSDI 4.x ?
\&  * Solaris 2.x ?
\&  * Windows NT 4.x (ActivePerl) ?
.Ve
.PP
If you find that it works on another platform, please let us 
know. Given that it is all Perl code, I expect it to be rather
portable to Unix and Unix-like systems. Heck, it \fImight\fR even work on
Win32 systems.
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
Help is always welcome in improving this software. Feel free to
contact the author (see \*(L"\s-1AUTHOR\*(R"\s0 below) with bug reports, fixes,
suggestions, and comments. Additionally \*(L"\s-1BUGS\*(R"\s0 will provide a list
of things this software is not able to do yet.
.PP
Having said that, here are the details on how it works and what you can
do with it.
.SS "The Basics"
.IX Subsection "The Basics"
\&\fBpgtop\fR was inspired by \fBmytop\fR (http://mytop.sourceforge.net/), which
in turn was inspired by the system monitoring tool \fBtop\fR.
.PP
\&\fBpgtop\fR will connect to a PostgreSQL server and periodically run
queries against the \fBpg_stat*\fR relations and attempt to
summarize the information from them in a useful format.
.SS "\s-1WHAT FOLLOWS REFERS TO MYTOP\s0"
.IX Subsection "WHAT FOLLOWS REFERS TO MYTOP"
What you read from now on has not been revised, and refers
to the original utility \f(CW\*(C`mytop\*(C'\fR.
.SS "The Display"
.IX Subsection "The Display"
The \fBmytop\fR display screen is really broken into two parts. The top 4
lines (header) contain summary information about your MySQL
server. For example, you might see something like:
.PP
MySQL on localhost (4.0.13\-log)                        up 1+11:13:00 [23:29:11]
 Queries: 19.3M  qps:  160 Slow:     1.0         Se/In/Up/De(%):    00/80/03/17
             qps now:  219 Slow qps: 0.0  Threads:    1 (   1/  16) 00/74/00/25
 Key Efficiency: 99.3%  Bps in/out: 30.5k/162.8   Now in/out: 32.7k/ 3.3k
.PP
The first line identifies the hostname of the server (localhost) and
the version of MySQL it is running. The right had side shows the
uptime of the MySQL server process in days+hours:minutes:seconds
format (much like FreeBSD's top) as well as the current time.
.PP
The second line displays the total number of queries the server has
processed, the average number of queries per second, the number of
slow queries, and the percentage of Select, Insert, Update, and Delete
queries.
.PP
The third real-time values. First is the number of queries per second,
then the number of slow queries, followed by query precentages (like
on the previous line).
.PP
And the fourth line displays key buffer efficiency (how often keys are
read from the buffer rather than disk) and the number of bytes that
MySQL has sent and received, both over all and in the last cycle.
.PP
You can toggle the header by hitting \fBh\fR when running \fBmytop\fR.
.PP
The second part of the display lists as many threads as can fit on
screen. By default they are sorted according to their idle time (least
idle first). The display looks like:
.PP
.Vb 3
\&    Id     User       Host      Dbase   Time      Cmd Query or State
\&    \-\-     \-\-\-\-       \-\-\-\-      \-\-\-\-\-   \-\-\-\-      \-\-\- \-\-\-\-\-\-\-\-\-\-\-\-\-\-
\&    61  jzawodn  localhost      music      0    Query show processlist
.Ve
.PP
As you can see, the thread id, username, host from which the user is
connecting, database to which the user is connected, number of seconds
of idle time, the command the thread is executing, and the query info
are all displayed.
.PP
Often times the query info is what you are really interested in, so it
is good to run \fBmytop\fR in an xterm that is wider than the normal 80
columns if possible.
.PP
The thread display color-codes the threads if you have installed color
support. The current color scheme only works well in a window with a
dark (like black) background. The colors are selected according to the
\&\f(CW\*(C`Command\*(C'\fR column of the display:
.PP
.Vb 3
\&    Query   \-  Yellow
\&    Sleep   \-  White
\&    Connect \-  Green
.Ve
.PP
Those are purely arbitrary and will be customizable in a future
release. If they annoy you just start \fBmytop\fR with the \fB\-nocolor\fR
flag or adjust your config file appropriately.
.SS "Arguments"
.IX Subsection "Arguments"
\&\fBmytop\fR handles long and short command-line arguments. Not all
options have both long and short formats, however. The long arguments
can start with one or two dashes `\-' or `\-\-'. They are shown here with
just one.
.IP "\fB\-u\fR or \fB\-user\fR username" 4
.IX Item "-u or -user username"
Username to use when logging in to the MySQL server. Default: ``root''.
.IP "\fB\-p\fR or \fB\-pass\fR or \fB\-password\fR password" 4
.IX Item "-p or -pass or -password password"
Password to use when logging in to the MySQL server. Default: none.
.IP "\fB\-h\fR or \fB\-host\fR hostname[:port]" 4
.IX Item "-h or -host hostname[:port]"
Hostname of the MySQL server. The hostname may be followed by an
option port number. Note that the port is specified separate from the
host when using a config file. Default: ``localhost''.
.IP "\fB\-port\fR or \fB\-P\fR port" 4
.IX Item "-port or -P port"
If you're running MySQL on a non-standard port, use this to specify
the port number. Default: 3306.
.IP "\fB\-s\fR or \fB\-delay\fR seconds" 4
.IX Item "-s or -delay seconds"
How long between display refreshes. Default: 5
.IP "\fB\-d\fR or \fB\-db\fR or \fB\-database\fR database" 4
.IX Item "-d or -db or -database database"
Use if you'd like \fBmytop\fR to connect to a specific database by
default. Default: ``test''.
.IP "\fB\-b\fR or \fB\-batch\fR or \fB\-batchmode\fR" 4
.IX Item "-b or -batch or -batchmode"
In batch mode, mytop runs only once, does not clear the screen, and
places no limit on the number of lines it will print. This is suitable
for running periodically (perhaps from cron) to capture the
information into a file for later viewing. You might use batch mode in
a \s-1CGI\s0 script to occasionally display your MySQL server status on the
web.
.Sp
Default: unset.
.IP "\fB\-S\fR or \fB\-socket\fR /path/to/socket" 4
.IX Item "-S or -socket /path/to/socket"
If you're running \fBmytop\fR on the same host as MySQL, you may wish to
have it use the MySQL socket directly rather than a standard \s-1TCP/IP\s0
connection. If you do,just specify one.
.Sp
Note that specifying a socket will make \fBmytop\fR ignore any host
and/or port that you might have specified. If the socket does not
exist (or the file specified is not a socket), this option will be
ignored and \fBmytop\fR will use the hostname and port number instead.
.Sp
Default: none.
.IP "\fB\-header\fR or \fB\-noheader\fR" 4
.IX Item "-header or -noheader"
Sepcify if you want the header to display or not. You can toggle this
with the \fBh\fR key while \fBmytop\fR is running.
.Sp
Default: header.
.IP "\fB\-color\fR or \fB\-nocolor\fR" 4
.IX Item "-color or -nocolor"
Specify if you want a color display. This has no effect if you don't
have color support available.
.Sp
Default: If you have color support, \fBmytop\fR will try color unless you
tell it not to.
.IP "\fB\-i\fR or \fB\-idle\fR or \fB\-noidle\fR" 4
.IX Item "-i or -idle or -noidle"
Specify if you want idle (sleeping) threads to appear in the list. If
sleeping threads are omitted, the default sorting order is reversed so
that the longest running queries appear at the top of the list.
.Sp
Default: idle.
.IP "\fB\-prompt\fR or \fB\-noprompt\fR" 4
.IX Item "-prompt or -noprompt"
Specify if you want to be prompted to type in your database password.
This provides a little bit more security since it not only prevents
the password from viewable in a process list, but also doesn't require
the password to be stored in plain text in your ~/.mytop config file.
You will \fBonly\fR be prompted if a password has not been specified in
your config file or through another command line option.
.Sp
Default: noprompt.
.IP "\fB\-resolve\fR" 4
.IX Item "-resolve"
If you have skip-resolve set on MySQL (to keep it from doing a reverse
\&\s-1DNS\s0 lookup on each inbound connection), mytop can replace \s-1IP\s0 addresses
with hostnames but toggling this option.
.Sp
Default: noresolve
.IP "\fB\-slow_threshold\fR" 4
.IX Item "-slow_threshold"
Defines the threshold in seconds after which a query must be considered
slow and it's logged to a file (`pgtop.log`).
.Sp
Default: 60
.IP "\fB\-slack_webhook\fR" 4
.IX Item "-slack_webhook"
If provided, in the form of a slack incoming webhook \s-1URL\s0 (e.g.
<https://hooks.slack.com/services/...>), it will be used to send notifications
for queries that are running longer than \f(CW\*(C`slow_threshold\*(C'\fR seconds.
.Sp
There is no default value, so no slack notification will be sent if this
parameter is not provided.
.Sp
Default: none
.PP
Command-line arguments will always take precedence over config file
options. That happens because the config file is read \fI\s-1BEFORE\s0\fR the
command-line arguments are applied.
.SS "Config File"
.IX Subsection "Config File"
Instead of always using bulky command-line parameters, you can also
use a config file in your home directory (\f(CW\*(C`~/.pgtop\*(C'\fR). If present,
\&\fBpgtop\fR will read it automatically. It is read \fIbefore\fR any of your
command-line arguments are processed, so your command-line arguments
will override directives in the config file.
.PP
Here is a sample config file \f(CW\*(C`~/.pgtop\*(C'\fR which implements the defaults
described above.
.PP
.Vb 10
\&  user=root
\&  pass=
\&  host=localhost
\&  db=test
\&  delay=5
\&  port=3306
\&  batchmode=0
\&  header=1
\&  color=1
\&  idle=1
.Ve
.PP
Using a config file will help to ensure that your database password
isn't visible to users on the command-line. Just make sure that the
permissions on \f(CW\*(C`~/.pgtop\*(C'\fR are such that others cannot read it (unless
you want them to, of course).
.PP
You may have white space on either side of the \f(CW\*(C`=\*(C'\fR in lines of the
config file.
.SS "Shortcut Keys"
.IX Subsection "Shortcut Keys"
The following keys perform various actions while \fBmytop\fR is
running. Those which have not been implemented are listed as
such. They are included to give the user idea of what is coming.
.IP "\fB?\fR" 4
.IX Item "?"
Display help.
.IP "\fBc\fR" 4
.IX Item "c"
Show \*(L"command counters\*(R" based on the Com_* values in \s-1SHOW STATUS.\s0
This is a new feature.  Feedback welcome.
.IP "\fBd\fR" 4
.IX Item "d"
Show only threads connected to a particular database.
.IP "\fBf\fR" 4
.IX Item "f"
Given a thread id, display the entire query that thread was (and still
may be) running.
.IP "\fBF\fR" 4
.IX Item "F"
Disable all filtering (host, user, and db).
.IP "\fBh\fR" 4
.IX Item "h"
Only show queries from a particular host.
.IP "\fBH\fR" 4
.IX Item "H"
Toggle the header display. You can also specify either \f(CW\*(C`header=0\*(C'\fR or
\&\f(CW\*(C`header=1\*(C'\fR in your config file to set the default behavior.
.IP "\fBi\fR" 4
.IX Item "i"
Toggle the display of idle (sleeping) threads. If sleeping threads are
filtered, the default sorting order is reversed so that the longest
running queries appear at the top of the list.
.IP "\fBk\fR" 4
.IX Item "k"
Kill a thread.
.IP "\fBK\fR" 4
.IX Item "K"
Kill all threads/queries that have been running for longer than a given
threshold in seconds.
.IP "\fBm\fR" 4
.IX Item "m"
Toggle modes. Currently this switches from `top' mode to `qps'
(Queries Per Second Mode). In this mode, mytop will write out one
integer per second. The number written reflects the number of queries
executed by the server in the previous one second interval.
.Sp
More modes may be added in the future.
.IP "\fBo\fR" 4
.IX Item "o"
Reverse the default sort order.
.IP "\fBp\fR" 4
.IX Item "p"
Pause display.
.IP "\fBq\fR" 4
.IX Item "q"
Quit \fBpgtop\fR
.IP "\fBr\fR" 4
.IX Item "r"
Reset the server's status counters via a \fI\s-1FLUSH STATUS\s0\fR command.
.IP "\fBs\fR" 4
.IX Item "s"
Change the sleep time (number of seconds between display refreshes).
.IP "\fBu\fR" 4
.IX Item "u"
Show only threads owned by a giver user.
.PP
The \fBs\fR key has a command-line counterpart: \fB\-s\fR.
.PP
The \fBh\fR key has two command-line counterparts: \fB\-header\fR and
\&\fB\-noheader\fR.
.SH "BUGS"
.IX Header "BUGS"
Probably many, but \f(CW\*(C`pgtop\*(C'\fR is still quite useful.
.SH "AUTHOR"
.IX Header "AUTHOR"
pgtop was adapted from mytop and is maintained by Cosimo Streppone
(\f(CW\*(C`cosimo@cpan.org\*(C'\fR).
.PP
mytop was developed and is maintained by Jeremy D. Zawodny
(\f(CW\*(C`Jeremy@Zawodny.com\*(C'\fR).
.PP
If you wish to e\-mail me regarding this software, please do!
.SH "DISCLAIMER"
.IX Header "DISCLAIMER"
This is certainly not a quality work, but before this crap, there
was nothing but pg_stat_* tables. Just like Jeremy, I needed
something more immediate and usable, like \fBtop\fR.
.PP
To tell the real truth, I didn't even know about \fBpg_stat\fR tables. :\-)
.PP
There is huge room for improvement!
.SH "COPYRIGHT"
.IX Header "COPYRIGHT"
Copyright (C) 2005\-2020, Cosimo Streppone.
Copyright (C) 2000\-2001, Jeremy D. Zawodny.
.SH "MYTOP CREDITS"
.IX Header "MYTOP CREDITS"
Fix a bug. Add a feature. See your name here!
.PP
Many thanks go to these fine folks:
.IP "Sami Ahlroos (sami@avis\-net.de)" 4
.IX Item "Sami Ahlroos (sami@avis-net.de)"
Suggested the idle/noidle stuff.
.IP "Jan Willamowius (jan@janhh.shnet.org)" 4
.IX Item "Jan Willamowius (jan@janhh.shnet.org)"
Mirnor bug report. Documentation fixes.
.IP "Alex Osipov (alex@acky.net)" 4
.IX Item "Alex Osipov (alex@acky.net)"
Long command-line options, Unix socket support.
.IP "Stephane Enten (tuf@grolier.fr)" 4
.IX Item "Stephane Enten (tuf@grolier.fr)"
Suggested batch mode.
.IP "Richard Ellerbrock (richarde@eskom.co.za)" 4
.IX Item "Richard Ellerbrock (richarde@eskom.co.za)"
Bug reports and usability suggestions.
.IP "William R. Mattil (wrm@newton.irngtx.tel.gte.com)" 4
.IX Item "William R. Mattil (wrm@newton.irngtx.tel.gte.com)"
Bug report about empty passwords not working.
.IP "Benjamin Pflugmann (philemon@spin.de)" 4
.IX Item "Benjamin Pflugmann (philemon@spin.de)"
Suggested \-P command-line flag as well as other changes.
.IP "Justin Mecham <justin@aspect.net>" 4
.IX Item "Justin Mecham <justin@aspect.net>"
Suggested setting \f(CW$0\fR to `mytop'.
.IP "Thorsten Kunz <thorsten.kunz@de.tiscali.com>" 4
.IX Item "Thorsten Kunz <thorsten.kunz@de.tiscali.com>"
Provided a fix for cases when we try remove the domain name from the
display even if it is actually an \s-1IP\s0 address.
.IP "Sasha Pachev <sasha@mysql.com>" 4
.IX Item "Sasha Pachev <sasha@mysql.com>"
Provided the idea of real-time queries per second in the main display.
.IP "Paul DuBois <paul@snake.net>" 4
.IX Item "Paul DuBois <paul@snake.net>"
Pointed out some option-handling bugs.
.IP "Mike Wexler <mwexler@tias.com>" 4
.IX Item "Mike Wexler <mwexler@tias.com>"
Suggested that we don't mangle (normalize) whitespace in query info by
default.
.IP "Mark Zweifel <markez@yahoo\-inc.com>" 4
.IX Item "Mark Zweifel <markez@yahoo-inc.com>"
Make the \-\-idle command-line argument negatable.
.IP "Axel Schwenke <schwenke@jobpilot.de>" 4
.IX Item "Axel Schwenke <schwenke@jobpilot.de>"
Noticed the inccorect formula for query cache hit percentages in
version 1.2.
.IP "Steven Roussey <sroussey@network54.com>" 4
.IX Item "Steven Roussey <sroussey@network54.com>"
Supplied a patch to help filter binary junk in queries so that
terminals don't freak out.
.IP "jon r. luini <falcon@chime.com>" 4
.IX Item "jon r. luini <falcon@chime.com>"
Supplied a patch that formed the basis for \f(CW\*(C`\-prompt\*(C'\fR support.  Sean
Leach <sleach@wiggum.com> submitted a similar patch.
.IP "Yogish Baliga <baliga@yahoo\-inc.com>" 4
.IX Item "Yogish Baliga <baliga@yahoo-inc.com>"
Supplied a patch that formed the basis for \f(CW\*(C`\-resolve\*(C'\fR support.
.IP "Per Andreas Buer <perbu@linpro.no>" 4
.IX Item "Per Andreas Buer <perbu@linpro.no>"
Supplied an excellent patch to tidy up the top display.  This includes
showing most values in short form, such as 10k rather than 10000.
.PP
See the Changes file on the \fBpgtop\fR distribution page for more
details on what has changed.
.SH "LICENSE"
.IX Header "LICENSE"
\&\fBpgtop\fR is licensed under the \s-1GNU\s0 General Public License version
2. For the full license information, please visit
http://www.gnu.org/copyleft/gpl.html
.SH "POD ERRORS"
.IX Header "POD ERRORS"
Hey! \fBThe above document had some coding errors, which are explained below:\fR
.IP "Around line 202:" 4
.IX Item "Around line 202:"
=cut found outside a pod block.  Skipping to next block.
.IP "Around line 208:" 4
.IX Item "Around line 208:"
=cut found outside a pod block.  Skipping to next block.
.IP "Around line 270:" 4
.IX Item "Around line 270:"
=cut found outside a pod block.  Skipping to next block.
.IP "Around line 276:" 4
.IX Item "Around line 276:"
=cut found outside a pod block.  Skipping to next block.
