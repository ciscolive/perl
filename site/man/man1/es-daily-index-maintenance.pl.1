.\" Automatically generated by Pod::Man 4.14 (Pod::Simple 3.40)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is >0, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{\
.    if \nF \{\
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{\
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\" ========================================================================
.\"
.IX Title "ES-DAILY-INDEX-MAINTENANCE 1"
.TH ES-DAILY-INDEX-MAINTENANCE 1 "2020-09-16" "perl v5.32.0" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
es\-daily\-index\-maintenance.pl \- Run to prune old indexes and optimize existing
.SH "VERSION"
.IX Header "VERSION"
version 7.8
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
es\-daily\-index\-maintenance.pl \-\-all \-\-local
.PP
Options:
.PP
.Vb 10
\&    \-\-help              print help
\&    \-\-manual            print full manual
\&    \-\-all               Run close, delete, optimize, and replicas tools
\&    \-\-close             Run close for indexes older than
\&    \-\-close\-days        Age of the oldest index to keep open (default:60)
\&    \-\-delete            Run delete indexes older than
\&    \-\-delete\-days       Age of oldest index to keep (default: 90)
\&    \-\-optimize          Run optimize on indexes
\&    \-\-optimize\-days     Age of first index to optimize (default: 1)
\&    \-\-replicas          Run the replic aging hook
\&    \-\-replicas\-age      Age of the index to reach the minimum replicas (default:60)
\&    \-\-replicas\-min      Minimum number of replicas this index may have (default:0)
\&    \-\-replicas\-max      Maximum number of replicas this index may have (default:1)
\&    \-\-skip\-alias        Indexes with these aliases will be skipped from all maintenance, can be set more than once
.Ve
.PP
From App::ElasticSearch::Utilities:
.PP
.Vb 10
\&    \-\-local         Use localhost as the elasticsearch host
\&    \-\-host          ElasticSearch host to connect to
\&    \-\-port          HTTP port for your cluster
\&    \-\-proto         Defaults to \*(Aqhttp\*(Aq, can also be \*(Aqhttps\*(Aq
\&    \-\-http\-username HTTP Basic Auth username
\&    \-\-http\-password HTTP Basic Auth password (if not specified, and \-\-http\-user is, you will be prompted)
\&    \-\-password\-exec Script to run to get the users password
\&    \-\-noop          Any operations other than GET are disabled, can be negated with \-\-no\-noop
\&    \-\-timeout       Timeout to ElasticSearch, default 30
\&    \-\-keep\-proxy    Do not remove any proxy settings from %ENV
\&    \-\-index         Index to run commands against
\&    \-\-base          For daily indexes, reference only those starting with "logstash"
\&                     (same as \-\-pattern logstash\-* or logstash\-DATE)
\&    \-\-datesep       Date separator, default \*(Aq.\*(Aq also (\-\-date\-separator)
\&    \-\-pattern       Use a pattern to operate on the indexes
\&    \-\-days          If using a pattern or base, how many days back to go, default: 1
.Ve
.PP
See also the \*(L"\s-1CONNECTION ARGUMENTS\*(R"\s0 and \*(L"\s-1INDEX SELECTION ARGUMENTS\*(R"\s0 sections from App::ElasticSearch::Utilities.
.PP
From CLI::Helpers:
.PP
.Vb 10
\&    \-\-data\-file         Path to a file to write lines tagged with \*(Aqdata => 1\*(Aq
\&    \-\-tags              A comma separated list of tags to display
\&    \-\-color             Boolean, enable/disable color, default use git settings
\&    \-\-verbose           Incremental, increase verbosity (Alias is \-v)
\&    \-\-debug             Show developer output
\&    \-\-debug\-class       Show debug messages originating from a specific package, default: main
\&    \-\-quiet             Show no output (for cron)
\&    \-\-syslog            Generate messages to syslog as well
\&    \-\-syslog\-facility   Default "local0"
\&    \-\-syslog\-tag        The program name, default is the script name
\&    \-\-syslog\-debug      Enable debug messages to syslog if in use, default false
\&    \-\-nopaste           Use App::Nopaste to paste output to configured paste service
\&    \-\-nopaste\-public    Defaults to false, specify to use public paste services
\&    \-\-nopaste\-service   Comma\-separated App::Nopaste service, defaults to Shadowcat
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
This script assists in maintaining the indexes for logging clusters through
routine deletion and optimization of indexes.
.PP
Use with cron:
.PP
.Vb 1
\&    22 4 * * * es\-daily\-index\-maintenance.pl \-\-local \-\-all \-\-delete\-days=180 \-\-replicas\-age=90 \-\-replicas\-min=1
.Ve
.SH "OPTIONS"
.IX Header "OPTIONS"
.IP "\fBclose\fR" 8
.IX Item "close"
Run the close hook
.IP "\fBclose-days\fR" 8
.IX Item "close-days"
Integer, close indexes older than this number of days
.IP "\fBdelete\fR" 8
.IX Item "delete"
Run the delete hook
.IP "\fBdelete-days\fR" 8
.IX Item "delete-days"
Integer, delete indexes older than this number of days
.IP "\fBoptimize\fR" 8
.IX Item "optimize"
Run the optimization hook
.IP "\fBoptimize-days\fR" 8
.IX Item "optimize-days"
Integer, optimize indexes older than this number of days
.IP "\fBreplicas\fR" 8
.IX Item "replicas"
Run the replicas hook.
.IP "\fBreplicas-age\fR" 8
.IX Item "replicas-age"
The age at which we reach \-\-replicas\-min, default 60
.IP "\fBreplicas-min\fR" 8
.IX Item "replicas-min"
The minimum number of replicas to allow replica aging to set.  The default is 0
.Sp
.Vb 1
\&    \-\-replicas\-min=1
.Ve
.IP "\fBreplicas-max\fR" 8
.IX Item "replicas-max"
The maximum number of replicas to allow replica aging to set.  The default is 1
.Sp
.Vb 1
\&    \-\-replicas\-max=2
.Ve
.IP "\fBskip-alias\fR" 8
.IX Item "skip-alias"
Can be set more than once.  Any indexes with an alias that matches this list is
skipped from operations.  This is a useful, lightweight mechanism to preserve
indexes.
.Sp
.Vb 1
\&    \-\-skip\-alias preserve \-\-skip\-alias pickle
.Ve
.Sp
In addition to user specified aliases, the aliases \f(CW\*(C`.hold\*(C'\fR and
\&\f(CW\*(C`.do_not_erase\*(C'\fR will always be excluded.
.SH "AUTHOR"
.IX Header "AUTHOR"
Brad Lhotsky <brad@divisionbyzero.net>
.SH "COPYRIGHT AND LICENSE"
.IX Header "COPYRIGHT AND LICENSE"
This software is Copyright (c) 2020 by Brad Lhotsky.
.PP
This is free software, licensed under:
.PP
.Vb 1
\&  The (three\-clause) BSD License
.Ve
