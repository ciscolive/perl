.\" Automatically generated by Pod::Man 4.14 (Pod::Simple 3.40)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is >0, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{\
.    if \nF \{\
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{\
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\" ========================================================================
.\"
.IX Title "ES-ALIAS-MANAGER 1"
.TH ES-ALIAS-MANAGER 1 "2020-09-16" "perl v5.32.0" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
es\-alias\-manager.pl \- Allow easy alias management for daily indexes
.SH "VERSION"
.IX Header "VERSION"
version 7.8
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
es\-alias\-manager.pl \-\-local \-\-config /etc/elasticsearch/aliases.yml
.PP
Options:
.PP
.Vb 4
\&    \-\-help              print help
\&    \-\-manual            print full manual
\&    \-\-config            Location of Config File, default /etc/elasticsearch/aliases.yml
\&    \-\-skip              Action name to be skipped, \*(Aqadd\*(Aq or \*(Aqremove\*(Aq, default none
.Ve
.PP
From App::ElasticSearch::Utilities:
.PP
.Vb 10
\&    \-\-local         Use localhost as the elasticsearch host
\&    \-\-host          ElasticSearch host to connect to
\&    \-\-port          HTTP port for your cluster
\&    \-\-proto         Defaults to \*(Aqhttp\*(Aq, can also be \*(Aqhttps\*(Aq
\&    \-\-http\-username HTTP Basic Auth username
\&    \-\-http\-password HTTP Basic Auth password (if not specified, and \-\-http\-user is, you will be prompted)
\&    \-\-password\-exec Script to run to get the users password
\&    \-\-noop          Any operations other than GET are disabled, can be negated with \-\-no\-noop
\&    \-\-timeout       Timeout to ElasticSearch, default 30
\&    \-\-keep\-proxy    Do not remove any proxy settings from %ENV
\&    \-\-index         Index to run commands against
\&    \-\-base          For daily indexes, reference only those starting with "logstash"
\&                     (same as \-\-pattern logstash\-* or logstash\-DATE)
\&    \-\-datesep       Date separator, default \*(Aq.\*(Aq also (\-\-date\-separator)
\&    \-\-pattern       Use a pattern to operate on the indexes
\&    \-\-days          If using a pattern or base, how many days back to go, default: 1
.Ve
.PP
See also the \*(L"\s-1CONNECTION ARGUMENTS\*(R"\s0 and \*(L"\s-1INDEX SELECTION ARGUMENTS\*(R"\s0 sections from App::ElasticSearch::Utilities.
.PP
From CLI::Helpers:
.PP
.Vb 10
\&    \-\-data\-file         Path to a file to write lines tagged with \*(Aqdata => 1\*(Aq
\&    \-\-tags              A comma separated list of tags to display
\&    \-\-color             Boolean, enable/disable color, default use git settings
\&    \-\-verbose           Incremental, increase verbosity (Alias is \-v)
\&    \-\-debug             Show developer output
\&    \-\-debug\-class       Show debug messages originating from a specific package, default: main
\&    \-\-quiet             Show no output (for cron)
\&    \-\-syslog            Generate messages to syslog as well
\&    \-\-syslog\-facility   Default "local0"
\&    \-\-syslog\-tag        The program name, default is the script name
\&    \-\-syslog\-debug      Enable debug messages to syslog if in use, default false
\&    \-\-nopaste           Use App::Nopaste to paste output to configured paste service
\&    \-\-nopaste\-public    Defaults to false, specify to use public paste services
\&    \-\-nopaste\-service   Comma\-separated App::Nopaste service, defaults to Shadowcat
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
This script assists in maintaining the aliases for relative or daily indexes across multiple datacenters.
.PP
Use with cron:
.PP
.Vb 1
\&    22 4 * * * es\-alias\-manager.pl \-\-local \-\-config /etc/elasticsearch/aliases.yml
.Ve
.PP
This will allow you to split your cluster between datacenters (or whatever) and alias the split clusters
to a homogenous index that standard LogStash/Kibana interfaces will understand.
.PP
If I create the following in /etc/elasticsearch/aliases.yml
.PP
.Vb 10
\&    \-\-\-
\&    pickle: ~
\&    logstash:
\&      pattern: \e*\-logstash\-{{DATE}}
\&      daily: logstash\-{{DATE}}
\&      relative:
\&        alias: logstash\-{{PERIOD}}
\&        periods:
\&          today:
\&            from:
\&              days: 0
\&            to:
\&              days: 0
\&          lastweek:
\&            from:
\&              days: 14
\&            to:
\&              days: 7
.Ve
.PP
The \f(CW\*(C`pickle\*(C'\fR alias is flagged as an alias to ignore in the addition/removal
process. This script will automatically ignore any alias that begins with a '.'.
.PP
Assuming today is the 2013.07.18 and I have 3 datacenters (\s-1IAD, NYC, AMS\s0) with the following indices:
.PP
.Vb 6
\&    iad\-logstash\-2013.07.17
\&    iad\-logstash\-2013.07.18
\&    nyc\-logstash\-2013.07.17
\&    nyc\-logstash\-2013.07.18
\&    ams\-logstash\-2013.07.17
\&    ams\-logstash\-2013.07.18
.Ve
.PP
The following aliases would be created
.PP
.Vb 4
\&    logstash\-2013.07.17
\&        |\- iad\-logstash\-2013.07.17
\&        |\- nyc\-logstash\-2013.07.17
\&        \`\- ams\-logstash\-2013.07.17
\&
\&    logstash\-2013.07.18
\&        |\- iad\-logstash\-2013.07.18
\&        |\- nyc\-logstash\-2013.07.18
\&        \`\- ams\-logstash\-2013.07.18
\&
\&    logstash\-today
\&        |\- iad\-logstash\-2013.07.18
\&        |\- nyc\-logstash\-2013.07.18
\&        \`\- ams\-logstash\-2013.07.18
.Ve
.PP
This lets you use index templates and the index.routing.allocation to isolate data by datacenter or another
parameter to certain nodes while allowing all the nodes to work together as cleanly as possible.  This also facilitates
the default expectations of Kibana to have a single index per day when you may need more.
.SS "\s-1PATTERN VARIABLES\s0"
.IX Subsection "PATTERN VARIABLES"
Patterns are used to match an index to the aliases it should have.  A few symbols are expanded into
regular expressions.  Those patterns are:
.PP
.Vb 3
\&    The \*(Aq*\*(Aq expands to match any number of any characters.
\&    The \*(Aq?\*(Aq expands to match any single character.
\&    {{DATE}} expands to match YYYY.MM.DD, YYYY\-MM\-DD, or YYYYMMDD
.Ve
.SS "\s-1ALIAS VARIABLES\s0"
.IX Subsection "ALIAS VARIABLES"
For daily indices, the following variables are available:
.PP
.Vb 1
\&    {{DATE}} \- Expands to YYYY.MM.DD for the current day of the current index
.Ve
.PP
For relative period indices, the following variable is \fBrequired\fR.
.PP
.Vb 1
\&    {{PERIOD}} \- Name of the period
.Ve
.SH "OPTIONS"
.IX Header "OPTIONS"
.IP "\fBconfig\fR" 8
.IX Item "config"
Location of the config file, default is /etc/elasticsearch/aliases.yml
.IP "\fBskip\fR" 8
.IX Item "skip"
Optionally skip a phase of alias management, valid phases are: add, remove
.SH "AUTHOR"
.IX Header "AUTHOR"
Brad Lhotsky <brad@divisionbyzero.net>
.SH "COPYRIGHT AND LICENSE"
.IX Header "COPYRIGHT AND LICENSE"
This software is Copyright (c) 2020 by Brad Lhotsky.
.PP
This is free software, licensed under:
.PP
.Vb 1
\&  The (three\-clause) BSD License
.Ve
