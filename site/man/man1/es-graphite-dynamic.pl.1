.\" Automatically generated by Pod::Man 4.14 (Pod::Simple 3.40)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is >0, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{\
.    if \nF \{\
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{\
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\" ========================================================================
.\"
.IX Title "ES-GRAPHITE-DYNAMIC 1"
.TH ES-GRAPHITE-DYNAMIC 1 "2020-09-16" "perl v5.32.0" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
es\-graphite\-dynamic.pl \- Dynamically gather metrics and send to graphite
.SH "VERSION"
.IX Header "VERSION"
version 7.8
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
es\-graphite\-dynamic.pl \-\-host [host] [options]
.PP
Options:
.PP
.Vb 10
\&    \-\-help              print help
\&    \-\-manual            print full manual
\&    \-\-carbon\-base       The prefix to use for carbon metrics (Default: general.es)
\&    \-\-carbon\-server     Send Graphite stats to Carbon Server (Automatically sets format=graphite)
\&    \-\-carbon\-port       Port for to use for Carbon (Default: 2003)
\&    \-\-carbon\-proto      Protocol for to use for Carbon (Default: tcp)
\&    \-\-with\-indices      Also send individual index stats
\&    \-\-ignore            Comma separated list of keys to ignore in collection
\&    \-\-prefix            A metric path to prefix stats, defaults to (\-\-carbon\-base).(hostname)
\&    \-\-no\-prefix         Don\*(Aqt prefix the metrics at all
.Ve
.PP
From App::ElasticSearch::Utilities:
.PP
.Vb 10
\&    \-\-local         Use localhost as the elasticsearch host
\&    \-\-host          ElasticSearch host to connect to
\&    \-\-port          HTTP port for your cluster
\&    \-\-proto         Defaults to \*(Aqhttp\*(Aq, can also be \*(Aqhttps\*(Aq
\&    \-\-http\-username HTTP Basic Auth username
\&    \-\-http\-password HTTP Basic Auth password (if not specified, and \-\-http\-user is, you will be prompted)
\&    \-\-password\-exec Script to run to get the users password
\&    \-\-noop          Any operations other than GET are disabled, can be negated with \-\-no\-noop
\&    \-\-timeout       Timeout to ElasticSearch, default 30
\&    \-\-keep\-proxy    Do not remove any proxy settings from %ENV
\&    \-\-index         Index to run commands against
\&    \-\-base          For daily indexes, reference only those starting with "logstash"
\&                     (same as \-\-pattern logstash\-* or logstash\-DATE)
\&    \-\-datesep       Date separator, default \*(Aq.\*(Aq also (\-\-date\-separator)
\&    \-\-pattern       Use a pattern to operate on the indexes
\&    \-\-days          If using a pattern or base, how many days back to go, default: 1
.Ve
.PP
See also the \*(L"\s-1CONNECTION ARGUMENTS\*(R"\s0 and \*(L"\s-1INDEX SELECTION ARGUMENTS\*(R"\s0 sections from App::ElasticSearch::Utilities.
.PP
From CLI::Helpers:
.PP
.Vb 10
\&    \-\-data\-file         Path to a file to write lines tagged with \*(Aqdata => 1\*(Aq
\&    \-\-tags              A comma separated list of tags to display
\&    \-\-color             Boolean, enable/disable color, default use git settings
\&    \-\-verbose           Incremental, increase verbosity (Alias is \-v)
\&    \-\-debug             Show developer output
\&    \-\-debug\-class       Show debug messages originating from a specific package, default: main
\&    \-\-quiet             Show no output (for cron)
\&    \-\-syslog            Generate messages to syslog as well
\&    \-\-syslog\-facility   Default "local0"
\&    \-\-syslog\-tag        The program name, default is the script name
\&    \-\-syslog\-debug      Enable debug messages to syslog if in use, default false
\&    \-\-nopaste           Use App::Nopaste to paste output to configured paste service
\&    \-\-nopaste\-public    Defaults to false, specify to use public paste services
\&    \-\-nopaste\-service   Comma\-separated App::Nopaste service, defaults to Shadowcat
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
This script collects interesting monitoring data from the ElasticSearch cluster and maps
that data directly into Graphite.  If ElasticSearch changes the names of data, those changes
will be reflected in the metric path immediately.
.SH "OPTIONS"
.IX Header "OPTIONS"
.IP "\fBhelp\fR" 8
.IX Item "help"
Print this message and exit
.IP "\fBmanual\fR" 8
.IX Item "manual"
Print this message and exit
.IP "\fBcarbon-base\fR" 8
.IX Item "carbon-base"
The prefix to use for metrics sent to carbon.  The default is \*(L"general.es\*(R".  Please note, the host name
of the ElasticSearch node will be appended, followed by the metric name.
.IP "\fBcarbon-server\fR" 8
.IX Item "carbon-server"
Send stats to the carbon server specified.  This automatically forces \-\-format=graphite
and does not produce stats on \s-1STDOUT\s0
.IP "\fBcarbon-port\fR" 8
.IX Item "carbon-port"
Use this port for the carbon server, useless without \-\-carbon\-server
.IP "\fBwith-indices\fR" 8
.IX Item "with-indices"
Also grab data at the individual index level, will not append hostnames as this is useless.  It will
map the data into \*(L"$CARBON_BASE.cluster.$CLUSTERNAME.$INDEX...\*(R"
.IP "\fBignore\fR" 8
.IX Item "ignore"
A comma separated list of keys to ignore when parsing the tree.  This is in addition to the
default ignore list: attributes,id,timestamp,upms,_all,_shards
.Sp
Examples:
.Sp
.Vb 1
\&    es\-graphite\-dynamic.pl \-\-with\-indices \-\-ignore primaries,get,warmer
.Ve
.IP "\fBprefix\fR" 8
.IX Item "prefix"
A metric path to prefix the collected stats with.  This is useful for using es\-graphite\-dynamic.pl with another
collector such as Diamond which expects metrics in a certain format.  To use with diamond's userscripts or files collector
you could:
.Sp
.Vb 2
\&    #!/bin/sh
\&    # userscripts
\&
\&    es\-graphite\-dynamic.pl \-\-local \-\-prefix elasticsearch
.Ve
.Sp
Or with the file collector, you could cron this:
.Sp
.Vb 1
\&    es\-graphite\-dynamic.pl \-\-local \-\-prefix elasticsearch \-\-data\-file /tmp/diamond/elasticsearch.out \-\-quiet
.Ve
.Sp
If not specified, the assumption is data will be going directly to graphite and the metric path will be set as:
.Sp
.Vb 1
\&    \*(Aqgeneral.es.$HOSTNAME\*(Aq
.Ve
.IP "\fBno-prefix\fR" 8
.IX Item "no-prefix"
Don't set the prefix to the metric names.
.SH "AUTHOR"
.IX Header "AUTHOR"
Brad Lhotsky <brad@divisionbyzero.net>
.SH "COPYRIGHT AND LICENSE"
.IX Header "COPYRIGHT AND LICENSE"
This software is Copyright (c) 2020 by Brad Lhotsky.
.PP
This is free software, licensed under:
.PP
.Vb 1
\&  The (three\-clause) BSD License
.Ve
