.\" Automatically generated by Pod::Man 4.14 (Pod::Simple 3.40)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is >0, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{\
.    if \nF \{\
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{\
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "LOAD_BALANCE 1"
.TH LOAD_BALANCE 1 "2020-08-25" "perl v5.32.0" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
load_balance.pl Load balance a host or network across two or more Internet connections.
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
.Vb 2
\& # get status report
\& % sudo load_balance.pl \-s
\&
\& # start link monitoring and load balance across all up ISPs
\& % sudo load_balance.pl
\&
\& # load balance across "CABLE" and "DSL" only
\& % sudo load_balance.pl CABLE DSL
\&
\& # print out the routing and firewall commands that would
\& # ordinarily be executed
\& % load_balance.pl \-d
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
This script can be run on a Linux-based home router or standalone
computer to load balance your network connection among two or more
Internet Service Providers (ISPs). When aggregated across multiple
simultaneous connections, you will achieve the sum of the bandwidth of
all \s-1ISP\s0 connections. In addition, the script will continuously ping
each outgoing interface and adjust routing in the event that one or
more ISPs become unavailable. This provides failover.
.PP
The script can be called with no arguments, in which case it will mark
all known ISPs as being up and launch the \*(L"lsm\*(R" link monitor to test
each one periodically for connectivity. It can also be called with one
or more symbolic names for \s-1ISP\s0 connections, as defined in
load_balance.conf. These will be forced \*(L"up\*(R" and other \s-1ISP\s0 connections
will be forced \*(L"down\*(R".
.PP
Other command-line options allow you to view the status of your \s-1ISP\s0
connections, kill a running lsm, and more.
.PP
Generally this script must be run as root, since it alters the routing
table and firewall rules.
.PP
For full installation and configuration instructions, please see
<http://lstein.github.io/Net\-ISP\-Balance/>.
.SH "COMMAND-LINE OPTIONS"
.IX Header "COMMAND-LINE OPTIONS"
Each command-line option can be abbreviated or used in long-form.
.PP
.Vb 3
\& \-\-debug, \-d     Turn on debugging. In this mode, no firewall or
\&                 routing commands will be executed, but instead
\&                 will be printed to standard output for inspection.
\&
\& \-\-verbose, \-v   Verbose output. Echo all route and iptables commands
\&                 to STDERR before executing them.
\&
\& \-\-Version, \-V   Print version of Net::ISP::Balance.
\&
\& \-\-status,\-s     Print current status of each monitored ISP interface
\&                 to STDOUT.
\&
\& \-\-kill,\-k       Kill any running lsm process.
\&
\& \-\-flush,\-f      Flush all firewall chains and rules. If not given, then
\&                 the default is to try to keep custom iptables rules 
\&                 introduced by firewall utilities such as fail2ban and
\&                 miniunpnpd.
\&
\& \-\-help,\-h       Print this message.
.Ve
.SH "COMMON USAGE"
.IX Header "COMMON USAGE"
This section describes common usage patterns. Note that
load_balance.pl must always be run as root.
.IP "Mark all ISPs as up and start link monitoring:" 4
.IX Item "Mark all ISPs as up and start link monitoring:"
.Vb 1
\& % sudo load_balance.pl
.Ve
.IP "Mark just the listed \s-1ISP\s0(s) as up. Do not start link monitoring:" 4
.IX Item "Mark just the listed ISP(s) as up. Do not start link monitoring:"
.Vb 1
\& % sudo load_balance.pl CABLE
.Ve
.IP "Bring up the listed \s-1ISP\s0 service, leaving the other(s) in their current state. This is usually done behind the scenes by lsm." 4
.IX Item "Bring up the listed ISP service, leaving the other(s) in their current state. This is usually done behind the scenes by lsm."
.Vb 1
\& % sudo load_balance.pl up CABLE
.Ve
.IP "Bring down the listed \s-1ISP\s0 service, leaving the other(s) in the current state. This is usually done behind the scenes by lsm:" 4
.IX Item "Bring down the listed ISP service, leaving the other(s) in the current state. This is usually done behind the scenes by lsm:"
.Vb 1
\& % sudo load_balance.pl down CABLE
.Ve
.IP "Print current status of the defined ISPs:" 4
.IX Item "Print current status of the defined ISPs:"
.Vb 1
\& % sudo load_balance.pl \-s
.Ve
.IP "Kill lsm and discontinue the link monitoring:" 4
.IX Item "Kill lsm and discontinue the link monitoring:"
.Vb 1
\& % sudo load_balance.pl \-k
.Ve
.IP "Print to standard output all the routing and firewall commands that would ordinarily be issued on startup. Do not launch lsm or actually change anything:" 4
.IX Item "Print to standard output all the routing and firewall commands that would ordinarily be issued on startup. Do not launch lsm or actually change anything:"
.Vb 1
\& % sudo load_balance.pl \-d
.Ve
.SH "FILES"
.IX Header "FILES"
This section gives locations of important files.
.SS "Debian/Ubuntu/Mint systems"
.IX Subsection "Debian/Ubuntu/Mint systems"
.Vb 3
\& /etc/network/balance.conf        # Main configuration file
\& /etc/network/balance/firewall/   # Additional firewall rules
\& /etc/network/balance/routes/     # Additional routing rules
.Ve
.SS "RedHat/CentOS systems"
.IX Subsection "RedHat/CentOS systems"
.Vb 3
\& /etc/sysconfig/network\-scripts/balance.conf        # Main configuration file
\& /etc/sysconfig/network\-scripts/balance/firewall/   # Additional firewall rules
\& /etc/sysconfig/network\-scripts/balance/routes/     # Additional routing rules
.Ve
.SS "Format of the balance.conf:"
.IX Subsection "Format of the balance.conf:"
balance.conf is the main configuration file. It defines the interfaces
connected to the ISPs and to the \s-1LAN\s0 (if running on a router). Here is
a typical example:
.PP
.Vb 4
\& #service    device   role     ping\-ip         weight  gateway
\& CABLE       eth0     isp      173.194.43.95     1     default
\& DSL         eth1     isp      173.194.43.95     1     default
\& LAN         eth2     lan      
\&
\& # name=value pairs define lsm configuration variables
\& warn_email=fred@gmail.com
\& max_packet_loss=10
\& min_packet_loss=5
.Ve
.PP
There are two parts of the configuration file. The first part, which
is required, is a four-column table that defines interfaces to be
monitored.
.PP
The first column is a service name that is used to bring up or down
the needed routes and firewall rules.
.PP
The second column is the name of the network interface device that
connects to that service.
.PP
The third column is either \*(L"isp\*(R" or \*(L"lan\*(R". There may be any number of
these. The script will load balance traffic across all ISPs, and will
act as a firewall between the \s-1LAN\s0 (if any) and the Internet. You do
not need to have a \*(L"lan\*(R" entry if this is a standalone host.
.PP
The fourth column (optional) is the \s-1IP\s0 address of a host that can be
periodically pinged to test the integrity of each \s-1ISP\s0 connection. If
too many pings failed, the service will be brought down and all
traffic routed through the remaining \s-1ISP\s0(s). The service will continue
to be monitored and will be brought up when it is once again
working. Choose a host that is not likely to go offline for reasons
unrelated to your network connectivity, such as google.com, or the
\&\s-1ISP\s0's web site. If this column is absent or marked \*(L"default\*(R", then the
host will default to www.google.ca.
.PP
The fifth column (optional) is a weight to assign to the service, and
is only valid for \s-1ISP\s0 rows. If weights are equal, traffic will be
apportioned evenly between the two routes. Increase a weight to favor
one \s-1ISP\s0 over the others. For example, if \*(L"\s-1CABLE\*(R"\s0 has a weight of 2 and
\&\*(L"\s-1DSL\*(R"\s0 has a weight of 1, then twice as much traffic will flow through
the \s-1CABLE\s0 service. If this column is omitted or marked \*(L"default\*(R", then
equal weights are assumed.
.PP
The sixth column (optional) is the \s-1IP\s0 address for the gateway host for
this service.  If absent or named \*(L"default\*(R", the system will attempt
to guess the proper gateway automatically. Note the guessing algorithm
relies on the fact that the gateway is almost always the first address
in the \s-1IP\s0 range for the subnetwork. If this is not the case, then
routing through the interface won't work properly. Add the correct
gateway \s-1IP\s0 address manually to correct this.
.PP
The second (optional) part of the configuration file is a series of
name=value pairs that allow you to customize the behavior of lsm, such
as where to send email messages when a link's status changes. Please
see <http://lsm.foobar.fi/> for the comprehensive list.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
Net::ISP::Balance
.SH "AUTHOR"
.IX Header "AUTHOR"
Lincoln Stein, lincoln.stein@gmail.com
.PP
Copyright (c) 2014\-2017 Lincoln D. Stein
.PP
This package and its accompanying libraries is free software; you can
redistribute it and/or modify it under the terms of the \s-1GPL\s0 (either
version 1, or at your option, any later version) or the Artistic
License 2.0.
